# 测试页的“两种模式”接口说明（对齐前端规范）
测试页yonghuguanli\yonghuguanli\test-client\index.html
## 1) Node 当前后端模式（已经实现，推荐现在用）
POST /api/auth/login（已实现：authController）
请求：{ phone, code, openid }
返回：{ token }（JWT）
GET /api/points/balance（已实现：pointsController，已加鉴权）
Headers：Authorization: Bearer <token>
返回：{ balance }
POST /api/points/redeem（已实现：pointsController，已加鉴权）
请求：{ code }
返回：{ message, points_added, balance }
POST /api/essay/submit（已实现：essayController，已加鉴权）
form-data：images 多个文件；可选 prompt
返回：{ code:0, msg:'ok', data:{ recordId } }
GET /api/essay/result/:id（已实现：essayController，已加鉴权）
返回：
processing：{ id, status:'processing', result:null }
completed：{ id, status:'completed', result:{ pdf_path, json_path, ... } }
failed：{ id, status:'failed', result:{ error ... } }
GET /api/essay/history（已实现：essayController，已加鉴权）
返回：当前用户历史记录简表
## 2) 规范模式（前端给的目标接口，当前未全部实现）
POST /api/user/login（未实现）
目前对应为 /api/auth/login（参数与返回略有不同）
方案：如需兼容，可新加一个 /api/user/login 的路由适配器，内部调用 authController.login 并转封装为 { code:0, data:{ token } }
POST /api/essay/upload（未实现）
规范：multipart/form-data：text(可选)、photo[]（多图）
目前我们是 /api/essay/submit（images，多图字段为 images）
方案：可新增 /api/essay/upload，兼容 photo[] 命名，内部转发到 submit
GET /api/essay/essay_analysis/:id 或 /latest（未实现）
目前对应：/api/essay/result/:id
方案：加一个适配路由，将 :id 的结果映射过去；/latest 可查 EssayRecord 最新一条
GET /api/essay/review_tasks?user_id=xxx（未实现）
目前对应：/api/essay/history（从 token 中识别用户）
方案：新增适配路由读取 query.user_id 并返回历史任务列表；或沿用 token 鉴权
已实现与未实现小结
已实现（Node 模式所需的所有接口）：/api/auth/login、/api/points/balance、/api/points/redeem、/api/essay/submit、/api/essay/result/:id、/api/essay/history
可快速补齐的适配接口（规范模式）：
/api/user/login → 适配 auth/login
/api/essay/upload（photo[] → images） → 适配 essay/submit
/api/essay/essay_analysis/:id → 适配 essay/result/:id
/api/essay/review_tasks → 适配 essay/history（或读取 query.user_id）
## 不改现有实现，“加一层映射”，前端即可无缝对接“规范模式”。